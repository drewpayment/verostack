
<div class="container">
    <div class="row mb-2">
        <div class="col-md-12">
            <mat-card class="page-header-accent">
                <mat-card-content class="d-flex justify-content-between">
                    <h3>Paychecks</h3>
                    <ng-container *ngIf="startDate != null && endDate != null">
                        <p class="text-muted font-italic m-0 p-0">Displaying paychecks from {{startDate | date:'shortDate'}} to {{endDate | date:'shortDate'}}</p>
                    </ng-container>
                </mat-card-content>
            </mat-card>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12 d-flex justify-content-between" [@slideInOut]="showChangeDateControls">
            <mat-form-field class="search-input ml-2">
                <mat-icon matPrefix class="text-muted">search</mat-icon>
                <mat-chip-list #chipList>
                    <mat-chip *ngFor="let input of inputs" selectable="false" removable="true" (removed)="removeInput(input)">
                        {{input}}
                        <mat-icon matChipRemove>cancel</mat-icon>
                    </mat-chip>
                    <input type="text" 
                        matInput 
                        placeholder="Filter by Name or Campaign"
                        [formControl]="searchInput"
                        [matChipInputFor]="chipList"
                        [matChipInputAddOnBlur]="true"
                        (matChipInputTokenEnd)="addInput($event)" />
                </mat-chip-list>
            </mat-form-field>
            <div>
                <mat-form-field class="px-2">
                    <input matInput [matDatepicker]="startPicker" placeholder="Start" [formControl]="startDateCtrl" [value]="startDateCtrl.value" />
                    <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                    <mat-datepicker #startPicker></mat-datepicker>
                </mat-form-field>
                <mat-form-field class="px-2">
                    <input matInput [matDatepicker]="endPicker" placeholder="End" [formControl]="endDateCtrl" [value]="endDateCtrl.value" />
                    <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
                    <mat-datepicker #endPicker></mat-datepicker>
                </mat-form-field>
            </div>
        </div>  
    </div>

    <div class="row">
        <!-- <ng-container *ngLet="paychecks$|async as paychecks"> -->
            <div class="col-md-12">
                <div class="mat-elevation-z2">
                    <mat-table [dataSource]="paychecks$" matSort (matSortChange)="sortTable($event)" matSortActive="weekEnding" matSortDirection="desc">
                        <ng-container matColumnDef="agentName">
                            <mat-header-cell *matHeaderCellDef mat-sort-header>Receivable</mat-header-cell>
                            <mat-cell *matCellDef="let item">{{item.agent.firstName}} {{item.agent.lastName}}</mat-cell>
                        </ng-container>

                        <ng-container matColumnDef="releaseDate">
                            <mat-header-cell *matHeaderCellDef mat-sort-header start="desc">Advice Date</mat-header-cell>
                            <mat-cell *matCellDef="let item">{{item.payroll.releaseDate | date:'mediumDate'}}</mat-cell>
                        </ng-container>

                        <ng-container matColumnDef="campaign">
                            <mat-header-cell *matHeaderCellDef mat-sort-header>Campaign</mat-header-cell>
                            <mat-cell *matCellDef="let item">{{item.payroll.campaign.name}}</mat-cell>
                        </ng-container>

                        <ng-container matColumnDef="amount">
                            <mat-header-cell *matHeaderCellDef mat-sort-header>Total</mat-header-cell>
                            <mat-cell *matCellDef="let item">{{item.grossTotal | currency}}</mat-cell>
                        </ng-container>

                        <mat-header-row *matHeaderRowDef="['agentName', 'releaseDate', 'campaign', 'amount']"></mat-header-row>
                        <mat-row *matRowDef="let row; columns:['agentName', 'releaseDate', 'campaign', 'amount']"
                            class="clickable paycheck-detail-row"
                            (click)="goToPaycheckDetail(row)"
                        ></mat-row>
                    </mat-table>
                    <mat-paginator
                        #paging
                        [pageSize]="10"
                        [pageSizeOptions]="[5, 10, 25, 50]"
                        showFirstLastButtons="true"
                        (page)="getPaychecks()"
                    ></mat-paginator>
                </div>
            </div>
        <!-- </ng-container> -->
    </div>
</div>